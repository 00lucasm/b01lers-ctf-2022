#jumpz to detect post reset
movfrom r0 0 r8
jmpz 20

movc r1 1
movc r6 3 #this is 3, but it is also 4 minus 1, to compare with secret index
movc r7 2
movc r9 2000000000 #lower than max/2 bitmask 
#movc r2 0 #secret index

mov r3 r1 #reset bitmask

movfrom r0 0 r2 #get a secret value from memory
and r0 r3
jmpz 2
movfrom r0 1000 r4 #touch the cache if bit is 1
add r4 r1 #increment r4

mov r0 r3
jmpg r9 3
mul r3 r7
jmp -8 

mov r0 r2
jmpg r6 3
add r2 r1
jmp -13

reset

#recover

#r5 index in cache
#r6 
#r7 bitmask
movc r9 2000000000 #max bitmask
#r4 time holder
#r1 v accumulator
movc r3 1
movc r2 2
movc r8 3 #time selector

mov r7 r3
mov r1 r0

time
mov r4 r0
movfrom r0 1000 r5
time
sub r0 r4

jmpg r8 2
or r1 r7

mov r0 r7
jmpg r9 4
mul r7 r2
add r5 r3
jmp -11

add r6 r3
mov r0 r6
sub r0 r3
jmpg r8 5
add r5 r3
movc r0 0
movto r1 2000 r6
jmp -21

movfrom r3 1999 r6
movfrom r2 1998 r6
movfrom r1 1997 r6
movfrom r0 1996 r6

magic



